+++
date = '2025-04-27T20:35:34+07:00'
title = 'ÄÃ o má»™ bÃºt kÃ­: Chuyá»ƒn Ä‘á»•i yate sang ná»n táº£ng Pháº§n tá»­ web'
tags = ['chuyá»‡n nghá»', 'yate']
series = ['yate']
series_weight = 2
+++

Gáº§n má»™t tuáº§n Ä‘Ã£ trÃ´i qua vÃ  mÃ¬nh cÅ©ng chuyá»ƒn Ä‘á»•i Ä‘Æ°á»£c pháº§n lá»›n mÃ£ nguá»“n sang ná»n táº£ng má»›i. Hi vá»ng sang tuáº§n sau cÃ³ thá»ƒ hoÃ n thÃ nh. Trong [bÃ i viáº¿t trÆ°á»›c](../unearthed-notes-building-my-own-browser-extension/), cÃ¡c báº¡n Ä‘Ã£ biáº¿t mÃ¬nh sá»­ dá»¥ng `Preact` Ä‘á»ƒ lÃ m giao diá»‡n. ÄÃ¡ng láº½ Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian, mÃ¬nh nÃªn sá»­a lá»—i thay vÃ¬ xÃ¢y dá»±ng láº¡i nhÆ° tháº¿ nÃ y, nhÆ°ng cÃ³ hai nguyÃªn nhÃ¢n khiáº¿n mÃ¬nh muá»‘n Ä‘á»•i ná»n táº£ng. 

Thá»© nháº¥t, Ä‘á»ƒ lÃ m tÃ­nh nÄƒng dá»‹ch trÃªn trang web, mÃ¬nh cáº§n nhÃºng mÃ£ cá»§a mÃ¬nh vÃ o trang. Má»™t sá»‘ trang web bá»‹ xung Ä‘á»™t CSS vá»›i tiá»‡n Ã­ch cá»§a mÃ¬nh nÃªn hiá»ƒn thá»‹ khÃ´ng Ä‘Æ°á»£c tá»‘t. Äá»ƒ kháº¯c phá»¥c, mÃ¬nh sá»­ dá»¥ng kÄ© thuáº­t [Shadow DOM](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM) nháº±m Ä‘áº£m báº£o tÃ¡ch biá»‡t háº³n pháº§n tá»­ cá»§a mÃ¬nh vá»›i cÃ¡c pháº§n tá»­ cá»§a trang web gá»‘c. `Preact` khÃ´ng há»— trá»£ kÄ© thuáº­t nÃ y. 

Thá»© hai, cÃ¡c thÆ° viá»‡n sinh pháº§n tá»­ nhÆ° `Preact`, `React`, vv Ä‘á»u sá»­ dá»¥ng `innerHTML` á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong mÃ£ nguá»“n. DÃ¹ mÃ¬nh khÃ´ng sá»­ dá»¥ng Ä‘áº¿n nhÆ°ng khi Ä‘Ã³ng gÃ³i tiá»‡n Ã­ch sáº½ bá»‹ cáº£nh bÃ¡o phÆ°Æ¡ng phÃ¡p nÃ y khÃ´ng an toÃ n. ÄÃ¢y cÅ©ng lÃ  má»™t trong sá»‘ cÃ¡c lÃ­ do cÃ³ thá»ƒ khiáº¿n tiá»‡n Ã­ch bá»‹ tá»« chá»‘i phÃª duyá»‡t, mÃ¬nh thÆ°á»ng pháº£i thÃªm má»™t Ä‘oáº¡n giáº£i thÃ­ch Ä‘á»ƒ há» thÃ´ng qua cho.

Váº­y nÃªn mÃ¬nh chuyá»ƒn sang `Web components` Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» trÃªn. Äá»•i láº¡i mÃ¬nh khÃ´ng thá»ƒ dÃ¹ng Ä‘Æ°á»£c `jsx` ná»¯a. Nhiá»u ngÆ°á»i khÃ´ng thÃ­ch `React` vÃ¬ cho ráº±ng viáº¿t `jsx` phÃ¡ há»ng cÃ¡c ngá»¯ nghÄ©a cá»§a web vÃ  khiáº¿n mÃ£ nguá»“n lá»™n xá»™n vÃ¬ trá»™n giá»¯a JS vÃ  HTML. Theo mÃ¬nh thÃ¬ Ä‘iá»u nÃ y chá»‰ Ä‘Ãºng Ä‘á»‘i vá»›i cÃ¡c tay mÆ¡ há»c láº­p trÃ¬nh. Thay vÃ¬ há»c tá»« gá»‘c thÃ¬ há» nháº£y tháº³ng vÃ o cÃ¡c thÆ° viá»‡n vÃ  bá»™ khung nÃªn khÃ´ng hiá»ƒu báº£n cháº¥t, dáº«n tá»›i mÃ£ nguá»“n tá»‡. DÃ¹ sao cÃ¡i gÃ¬ cÅ©ng cÃ³ tÃ­nh hai máº·t, Ä‘Æ°á»£c cÃ¡i nÃ y máº¥t cÃ¡i kia lÃ  chuyá»‡n thÆ°á»ng. So vá»›i lá»£i Ã­ch Ä‘áº¡t Ä‘Æ°á»£c thÃ¬ hi sinh má»™t chÃºt tráº£i nghiá»‡m láº­p trÃ¬nh cÅ©ng Ä‘Ã¡ng.

`Pháº§n tá»­ web` lÃ  cÃ´ng nghá»‡ Ä‘Æ°á»£c há»— trá»£ sáºµn bá»Ÿi trÃ¬nh duyá»‡t cho phÃ©p báº¡n Ä‘Ã³ng gÃ³i cÃ¡c thÃ nh pháº§n trong má»™t trang web theo hÆ°á»›ng pháº§n tá»­, tÆ°Æ¡ng tá»± nhÆ° cÃ¡ch cÃ¡c thÆ° viá»‡n Ä‘ang lÃ m. Æ¯u Ä‘iá»ƒm lÃ  mÃ¬nh cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i DOM mÃ  khÃ´ng cáº§n tá»›i cÃ¡c cÆ¡ cháº¿ quáº£n lÃ½ tráº¡ng thÃ¡i phá»©c táº¡p. Nhá» tháº¿ logic xá»­ lÃ­ cá»§a mÃ¬nh giáº£m Ä‘i nhiá»u mÃ  mÃ£ nguá»“n cÅ©ng khÃ´ng thay Ä‘á»•i máº¥y. Viá»‡c cá»§a mÃ¬nh chá»‰ lÃ  bÃª cÃ¡c pháº§n tá»­ tá»« `Preact` sang, tiá»‡n thá»ƒ cáº£i tiáº¿n luÃ´n nhá»¯ng gÃ¬ cÃ²n thiáº¿u sÃ³t trong phiÃªn báº£n trÆ°á»›c.

Cháº³ng háº¡n, pháº§n tá»­ `chá»n ngÃ´n ngá»¯` trÆ°á»›c Ä‘Ã¢y chá»‰ dÃ¹ng chuá»™t Ä‘á»ƒ chá»n Ä‘Æ°á»£c, giá» cÃ³ thá»ƒ chá»n báº±ng bÃ n phÃ­m. Pháº§n xá»­ lÃ­ khÃ´ng quÃ¡ phá»©c táº¡p nhÆ°ng táº¡i thá»i Ä‘iá»ƒm lÃ m ra `yate`, mÃ¬nh cÅ©ng chÆ°a vá»¯ng láº¯m vá» quáº£n lÃ­ tráº¡ng thÃ¡i trong `React` nÃªn loay hoay mÃ£i khÃ´ng xong. Káº¿ Ä‘áº¿n lÃ  pháº§n nháº­p chá»¯, náº¿u gÃµ nhanh quÃ¡ thÃ¬ cÃ³ thá»ƒ máº¥t chá»¯, dáº«n tá»›i dá»‹ch thiáº¿u. NguyÃªn do lÃ  mÃ¬nh sá»­ dá»¥ng kÄ© thuáº­t [debounce (chá»‘ng náº£y)](https://css-tricks.com/debouncing-throttling-explained-examples/) Ä‘á»ƒ giáº£m bá»›t sá»‘ lÆ°á»£ng sá»± kiá»‡n pháº£i xá»­ lÃ­. Sau khi bá» Ä‘i má»› tráº¡ng thÃ¡i cá»§a `Preact`, mÃ¬nh chá»‰ cáº§n táº­p trung vÃ o sá»± kiá»‡n chÃ­nh lÃ  láº¥y cÃ¡c tá»« má»›i Ä‘em Ä‘i dá»‹ch, nhá» tháº¿ hiá»‡u suáº¥t tÄƒng lÃªn rÃµ rá»‡t ğŸ˜.

Má»™t lÆ°u Ã½ nhá» cho báº¡n nÃ o má»›i lÃ m quen vá»›i `pháº§n tá»­ web`: náº¿u cáº§n xá»­ lÃ­ sá»± kiá»‡n riÃªng (CustomEvent) cá»§a pháº§n tá»­, Ä‘á»«ng Ä‘áº·t tÃªn sá»± kiá»‡n trÃ¹ng vá»›i cÃ¡c sá»± kiá»‡n cÃ³ sáºµn cá»§a trÃ¬nh duyá»‡t vÃ  Ä‘áº£m báº£o nÃ³ chá»‰ xáº£y ra trong pháº§n tá»­ Ä‘Ã³ (Ä‘áº·t thuá»™c tÃ­nh `bubbles = false`). Náº¿u khÃ´ng báº¡n sáº½ gáº·p pháº£i tÃ¬nh huá»‘ng khÃ´ng biáº¿t pháº§n tá»­ nÃ o phÃ¡t Ä‘i sá»± kiá»‡n hay sá»± kiá»‡n bá»‹ gá»i nhiá»u láº§n nhÆ° mÃ¬nh Ä‘Ã£ dÃ­nh pháº£i [d3c62ee](https://github.com/kien5436/yate/commit/d3c62ee49891fe87702f23430bc16daeaf0972d7).

Táº¡m thá»i tuáº§n nÃ y káº¿t thÃºc vá»›i viá»‡c hoÃ n thÃ nh chá»©c nÄƒng dá»‹ch báº±ng cá»­a sá»• thu nhá», tuáº§n tá»›i mÃ¬nh sáº½ lÃ m ná»‘t dá»‹ch trÃªn trang. Háº¹n gáº·p láº¡i!
